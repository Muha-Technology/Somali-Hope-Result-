<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Somali Hope Secondary School â€“ Results</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --primary:#0d47a1;     /* Deep blue */
  --secondary:#1976d2;   /* Medium blue */
  --light:#e3f2fd;       /* Light blue */
  --bg:#f4f9ff;
}

body{
  font-family: Arial, sans-serif;
  background: var(--bg);
  margin: 0;
}

/* MAIN CARD */
.container{
  max-width:560px;
  margin:25px auto;
  background:#fff;
  padding:22px;
  border-radius:14px;
  box-shadow:0 6px 25px rgba(0,0,0,.15);
  position:relative;
  overflow:hidden;
}

/* WATERMARK */
.container::before{
  content:"";
  background:url("https://raw.githubusercontent.com/Muha-Technology/Somali-Hope-Asset/main/Logo.png")
    center no-repeat;
  background-size:280px;
  opacity:0.05;
  position:absolute;
  inset:0;
  pointer-events:none;
}

.content{position:relative;z-index:2}

/* HEADER */
header{
  text-align:center;
  margin-bottom:10px;
}
header img{
  width:90px;
}
h2{
  color:var(--primary);
  margin:6px 0;
}
.subtitle{
  font-weight:bold;
  color:#333;
  border-bottom:2px solid var(--secondary);
  display:inline-block;
  padding-bottom:4px;
}

/* INPUTS */
input, button{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:16px;
  box-sizing:border-box;
}

input{
  border:1px solid #bbb;
  border-radius:6px;
}

button{
  background:linear-gradient(135deg, var(--primary), var(--secondary));
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

button:hover{
  opacity:0.9;
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:14px;
}

th, td{
  border:1px solid #ccc;
  padding:7px;
  text-align:center;
}

th{
  background:var(--light);
  color:var(--primary);
}

/* SUMMARY */
.summary{
  margin-top:15px;
  padding:10px;
  background:var(--light);
  border-radius:8px;
  font-weight:bold;
}

/* FOOTER */
.footer{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:20px;
}

/* PRINT */
@media print{
  input,button{display:none}
  body{background:#fff}
  .container{
    box-shadow:none;
    margin:0;
    border-radius:0;
  }
}
</style>
</head>

<body>

<div class="container">
<div class="content">

<header>
  <img src="https://raw.githubusercontent.com/Muha-Technology/Somali-Hope-Asset/main/Logo.png">
  <h2>Somali Hope Secondary School</h2>
  <div class="subtitle">OFFICIAL RESULT SLIP</div>
</header>

<input id="studentId" placeholder="Enter Student ID">
<button onclick="fetchResult()">View Result</button>
<button onclick="window.print()">ðŸ–¨ Print / Save PDF</button>

<div id="result"></div>

</div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbwds9K9BIIQW9p7_UHA6P9zfRx9VrDgfJe8Qq3yQ4y68lupJVjsTICg_yhwltcXPnOZ/exec";

const MAX_ATTEMPTS = 5;
const BLOCK_TIME = 15 * 60 * 1000; // 15 minutes

function getAttemptData(){
  const d = localStorage.getItem("attemptData");
  return d ? JSON.parse(d) : { count: 0, time: 0 };
}

function saveAttemptData(d){
  localStorage.setItem("attemptData", JSON.stringify(d));
}

function fetchResult(){
  const id = document.getElementById("studentId").value.trim();
  if(!id){
    alert("Please enter Student ID");
    return;
  }

  let attemptData = getAttemptData();
  const now = Date.now();

  if(now - attemptData.time > BLOCK_TIME){
    attemptData = { count: 0, time: now };
  }

  if(attemptData.count >= MAX_ATTEMPTS){
    alert("Too many attempts. Try again after 15 minutes.");
    return;
  }

  attemptData.count++;
  attemptData.time = now;
  saveAttemptData(attemptData);

  document.getElementById("result").innerHTML = "Loading...";

  fetch(API + "?action=result&id=" + encodeURIComponent(id))
    .then(r => r.json())
    .then(d => {
      if(!d || !d.name){
        document.getElementById("result").innerHTML =
          "<p style='color:red'>Result not found</p>";
        return;
      }

      let rows = "";
      d.subjects.forEach(s=>{
        rows += `
          <tr>
            <td>${s.name}</td>
            <td>${s.marks}</td>
            <td>${s.grade}</td>
          </tr>`;
      });

      document.getElementById("result").innerHTML = `
        <hr>
        <p><strong>Name:</strong> ${d.name}</p>
        <p><strong>Term:</strong> ${d.term} | <strong>Year:</strong> ${d.year}</p>

        <table>
          <tr><th>Subject</th><th>Marks</th><th>Grade</th></tr>
          ${rows}
        </table>

        <div class="summary">
          Total: ${d.total}<br>
          Average: ${d.average}<br>
          Overall Grade: ${d.grade}
        </div>

        <div class="footer">
          <div>
            <strong>Principalâ€™s Signature</strong><br>
            ____________________
          </div>
          <div>
            <img src="${d.qr}" width="110"><br>
            <small>Verify Result</small>
          </div>
        </div>
      `;
    })
    .catch(()=>{
      document.getElementById("result").innerHTML =
        "<p style='color:red'>Server error</p>";
    });
}
</script>

</body>
</html>
